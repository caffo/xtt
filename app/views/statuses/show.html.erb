<% box(:special, "overview") do |box| %>
  <% if @status.finished_at %>
    <% box.title = "#{@status.created_at.strftime('%A, %B %d %I:%M %p')}  - #{@status.finished_at.strftime("%A, %B %d %I:%M %p")}" %>
  <% else %>
    <% box.title = %(#{@status.created_at.strftime('%A, %B %d %I:%M %p')} - Now) %>
  <% end %>
  
  <% box.content = capture do %>
  <ul class="media-list">
    <li class="media-item clearfix last">
      <div class="media">
        <%= gravatar_for current_user %>
      </div>
      <div class="media-content">
        <h4 class="media-title"><%=h @status.message %></h4>
        <p class="quiet">posted <%= status_at @status %></p>
        <% if @status.followup.nil? %>
        <span class="others">
          <span class="num"><%= nice_timer_for @status %></span>
          <span class="meta">logged</span>
        </span>
        <% else %>
        <span class="others">
          <span class="num"><%= @status.hours.to_f %></span>
          <span class="meta">hour<%= :s unless @status.hours == 1.0 %></span>
        </span>
        <% end %>
      </div>
    </li>
  </ul>
  <% end %>

<% end %>

<% unless @status.active? %>
  <% box :normal, 'form' do |box| %>
    <% box.title = "Modify this status" %>
    <% box.content = capture do %>
    <% form_for @status, :html => { :id => 'edit-status-hours', :class => 'form' } do |f| %>
    <table cellspacing="0" cellpadding="0" class="tblform">
      <tr>
        <th>
					<%= f.label :set_hours, "Total hour(s) worked:" %>
        </th>
        <td>
					<%= f.text_field :set_hours %>
          <p class="quiet">Modifying your time could potentially cause overlap with your other statuses.</p>
        </td>
      </tr>
      <tr>
        <td colspan="2"><p class="btns"><%= save_button %> or <%= link_to 'edit times', '#', :class => 'edit-status-link' %></p></td>
      </tr>
    </table>
      <% end %>
    <% form_for @status, :html => { :id => 'edit-status-times', :class => 'form', :style => 'display:none' } do |f| %>
    <table cellspacing="0" cellpadding="0" class="tblform">
			<tr>
				<th>
					<%= f.label :created_at, "Start Time:" %>
				</th>
				<td>
					<%= f.date_select :created_at %>
					<%= f.time_select :created_at %>
				</td>
			</tr>
			<tr>
				<th>
					<%= f.label :finished_at, "End Time:" %>
				</th>
				<td>
					<%= f.date_select :finished_at %>
					<%= f.time_select :finished_at %>
				</td>
			</tr>
      <tr>
        <td colspan="2"><p class="btns"><%= save_button %> or <%= link_to 'edit hours', '#', :class => 'edit-status-link' %></p></td>
      </tr>
    </table>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%= yield :normal_box %>


<% box(:sidebar, 'details') do |sbox| %>
  <% sbox.title = "Other status details" %>
  <% sbox.content_classes = "nopad" %>
  <% sbox.content = capture do %>
    <ul id="status-list">
      <% if @status.previous %>
      <li<%= %( class="last") if @status.followup.nil? %>>
        <a href="<%= status_path(@status.previous) %>">
          <span class="quiet">Previous status</span>
          <em><%=h @status.previous.message %></em>
          <span class="start-fin">
            <span class="start">
              <span class="time"><%= start_time_for(@status.previous) %></span>
              <span class="month"><%= js_day @status.previous.created_at %></span>
            </span>
            <span class="dash">-</span>
            <span class="finish">
              <span class="time"><%= finish_time_for(@status.previous) %></span>
              <span class="month"><%= js_day @status.previous.finished_at %></span>
            </span>
            <span class="equals">=</span>
            <span class="hours">
              <span class="time"><%= @status.previous.hours %></span>
              <span class="month">hour<%= :s unless @status.previous.hours == 1.0 %></span>
            </span>
          </span>
        </a>
      </li>
      <% end %>
      <% if @status.followup %>
      <li class="last">
        <a href="<%= status_path(@status.followup) %>">
          <span class="quiet">Next status</span>
           <em><%=h @status.followup.message %></em>
          <span class="start-fin">
            <span class="start">
              <span class="time"><%= start_time_for(@status.followup) %></span>
              <span class="month"><%= js_day @status.created_at %></span>
            </span>
            <span class="dash">-</span>
            <span class="finish">              
              <% unless @status.followup.active? %>
              <span class="time"><%= finish_time_for(@status.followup) %></span>
              <span class="month"><%= js_day @status.followup.finished_at %></span>
              <% else %>
              <span class="time">Now</span>
              <span class="month"><%= js_day Time.now %></span>
              <% end %>
            </span>
            <span class="equals">=</span>
            <span class="hours">
              <span class="time"><%= @status.followup.hours %></span>
              <span class="month">hour<%= :s unless @status.followup.hours == 1.0 %></span>
            </span>
          </span>
        </a>
      </li>
      <% end %>
    </ul>
  <% end %>
<% end %>
