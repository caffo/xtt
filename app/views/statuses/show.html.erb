<% box(:special, "overview") do |box| %>

  <% if @status.followup %>
    <% box.title = %(<span class="utc">#{@status.created_at.to_s}</span> - <span class="utc">#{@status.followup.created_at.to_s}</span>) %>
  <% else %>
    <% box.title = %(<span class="utc">#{@status.created_at.to_s}</span> - Now</span>) %>
  <% end %>
  
  <% box.content = capture do %>
  <ul class="media-list">
    <li class="media-item clearfix last">
      <div class="media">
        <%= gravatar_for current_user %>
      </div>
      <div class="media-content">
        <h4 class="media-title"><%=h @status.message %></h4>
        <p class="quiet">posted <%= status_at @status %></p>
        <% if @status.followup.nil? %>
        <span class="others">
          <span class="num"><%= nice_timer_for @status %></span>
          <span class="meta">logged</span>
        </span>
        <% else %>
        <span class="others">
          <span class="num"><%= @status.hours.to_f %></span>
          <span class="meta">hours</span>
        </span>
        <% end %>
      </div>
    </li>
  </ul>
  <% end %>

<% end %>

<% content_for :dom_loaded do %>
  startDate = new Date(Date.parse("<%= @status.created_at %>"));
  <% if @status.followup %>
  endDate   = new Date(Date.parse("<%= @status.followup.created_at %>"));
  <% end %>
<% end %>

<% unless @status.active? %>
  <% box :normal, 'form' do |box| %>
    <% box.title = "Modify this status" %>
    <% box.content = capture do %>
    <% form_for @status, :html => { :id => 'edit-status', :class => 'form' } do |f| %>
    <table cellspacing="0" cellpadding="0" class="tblform">
      <tr>
        <th>
          <label for="status">Started <%= @status.created_at.strftime("%A, %B %d") %> at:</label>
        </th>
        <td>
          <input type="text" id="created-at" name="status[set_created_at]" value="<%= @status.created_at.strftime("%I:%m %p") %>" title="<%= @status.created_at %>" />
          <% if @status.previous %><p class="quiet">Changing the start time will change the finish time of the previous status: <strong>&ldquo;<%=h @status.previous.message %>&rdquo;</strong></p><% end %>
        </td>
      </tr>
      <% if @status.followup %>
      <tr>
        <th><label for="status">Finished <%= @status.followup.created_at.strftime("%A, %B %d") %> at:</label></th>
        <td>
          <input type="text" id="finished-at" name="status[set_finished_at]" value="<%= @status.followup.created_at.strftime("%I:%m %p") %>" title="<%= @status.followup.created_at %>" />
          <p class="quiet">Changing the finish time will alter the start time of the following status: <strong>&ldquo;<%=h @status.followup.message %>&rdquo;</strong></p>
        </td>
      </tr>
      <% end %>
      <tr>
        <th>
          <label for="status">Total hours worked:</label>
        </th>
        <td>
          <input type="text" id="hours-worked" name="status[set_hours_worked]" value="<%= @status.hours %>" />
          <p class="quiet">Changing the hours worked will change the finish time of this status and the start time of your following status: <strong>&ldquo;<%=h @status.followup.message %>&rdquo;</strong></p>
        </td>
      </tr>
      <tr>
        <td colspan="2"><p class="btns"><%= save_button %></p></td>
      </tr>
    </table>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%= yield :normal_box %>


<% box(:sidebar, 'details') do |sbox| %>
  <% sbox.title = "Other status details" %>
  <% sbox.content_classes = "nopad" %>
  <% sbox.content = capture do %>
    <ul id="status-list">
      <% if @status.previous %>
      <li<%= %( class="last") if @status.followup.nil? %>>
        <a href="<%= status_path(@status.previous) %>">
          <span class="quiet">Previous status: <em><%=h @status.previous.message %></em></span>
          <span class="start-fin">
            <span class="start">
              <span class="time"><%= start_time_for(@status.previous) %></span>
              <span class="month">January 22</span>
            </span>
            <span class="dash">-</span>
            <span class="finish">
              <span class="time"><%= finish_time_for(@status.previous) %></span>
              <span class="month">January 22</span>
            </span>
            <span class="hours">
              <span class="time"><%= @status.previous.hours %></span>
              <span class="month">hours</span>
            </span>
          </span>
        </a>
      </li>
      <% end %>
      <% if @status.followup %>
      <li class="last">
        <a href="<%= status_path(@status.followup) %>">
          <span class="quiet">Next status: <em><%=h @status.followup.message %></em></span>
          <span class="start-fin">
            <span class="start">
              <span class="time"><%= start_time_for(@status.followup) %></span>
              <span class="month">January 23</span>
            </span>
            <span class="dash">-</span>
            <span class="finish">
              <% unless @status.followup.active? %>
              <span class="time"><%= finish_time_for(@status.followup) %></span>
              <span class="month">January 23</span>
              <% else %>
              <span class="time">Now</span>
              <span class="month"><%= Time.now.strftime("%B %d") %></span>
              <% end %>
            </span>
            <span class="hours">
              <span class="time"><%= @status.followup.hours %></span>
              <span class="month">hours</span>
            </span>
          </span>
        </a>
      </li>
      <% end %>
    </ul>
  <% end %>
<% end %>
